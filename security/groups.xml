<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- CATEGORY -->
        <record model="ir.module.category" id="module_category_marketplace">
            <field name="name">Marketplace</field>
            <field name="description">Gestion de la place de marché multi-vendeurs.</field>
            <field name="sequence">10</field>
        </record>

        <!-- GROUPS -->
        <!-- Groupe Vendeur -->
        <record id="group_marketplace_vendor" model="res.groups">
            <field name="name">Vendeur</field>
            <field name="category_id" ref="module_category_marketplace"/>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/> <!-- Ou base.group_portal pour accès externe -->
        </record>

        <!-- Groupe Manager (Admin) -->
        <record id="group_marketplace_manager" model="res.groups">
            <field name="name">Manager Marketplace</field>
            <field name="category_id" ref="module_category_marketplace"/>
            <field name="implied_ids" eval="[(4, ref('group_marketplace_vendor'))]"/>
            <field name="users" eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"/>
        </record>

        <!-- RECORD RULES (Règles de visibilité) -->

        <!-- Règle 1: Le vendeur ne voit que son propre profil -->
        <record id="rule_marketplace_vendor_own_profile" model="ir.rule">
            <field name="name">Vendeur: voir son propre profil</field>
            <field name="model_id" ref="model_marketplace_vendor"/>
            <field name="domain_force">[('partner_id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('group_marketplace_vendor'))]"/>
        </record>
        <record id="rule_marketplace_manager_all_vendors" model="ir.rule">
            <field name="name">Manager: voir tous les vendeurs</field>
            <field name="model_id" ref="model_marketplace_vendor"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_marketplace_manager'))]"/>
        </record>

        <!-- Règle 2: Le vendeur ne voit que ses propres commissions -->
        <record id="rule_marketplace_vendor_own_commission" model="ir.rule">
            <field name="name">Vendeur: voir ses propres commissions</field>
            <field name="model_id" ref="model_marketplace_commission"/>
            <field name="domain_force">[('vendor_id.partner_id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('group_marketplace_vendor'))]"/>
        </record>

        <!-- Règle 3: Le vendeur ne voit que ses propres produits -->
        <record id="rule_marketplace_vendor_own_product" model="ir.rule">
            <field name="name">Vendeur: voir ses propres produits</field>
            <field name="model_id" ref="product.model_product_template"/>
            <field name="domain_force">['|', ('vendor_id', '=', False), ('vendor_id.partner_id', '=', user.partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('group_marketplace_vendor'))]"/>
        </record>

    </data>
</odoo>